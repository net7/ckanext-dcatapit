<section class="rtds-pb-4 rtds-pt-4 md:rtds-px-6 rtds-grid rtds-gap-8 rtds-border-b rtds-border-gray-03">
	<h3 class="rtds-heading-3">{{ _('Dataset Metadata') }}</h3>

	{% asset 'ckanext-dcatapit/dcatapit_style' %}
	<dl class="rtds-grid rtds-gap-4">
		{% block dcatapit_additional_info %}
			{% set schema_fields = h.get_dcatapit_package_schema() %}
			{% set lang = h.lang() %}

			{% for field in schema_fields %}
				{% if not field.ignore and not field.ignore_from_info %}

					{% if field.element == 'couple' %}
						{% set couples = h.couple_to_dict(field.couples, pkg_dict)%}
						<div class="rtds-grid lg:rtds-grid-cols-12">
							<dt class="rtds-col-span-3">{{ field.label }}</dt>
							<dd class="rtds-col-span-9 rtds-content-03 rtds-truncate">
								{% if couples %}
									{% for couple in couples %}
										{% if couple %}
											<span>{{couple.label}}:
											</span>
											<span>{{couple.value}}</span><br/>
										{% else %}
											{{ _('N/D') }}
										{% endif %}
									{% endfor %}
								{% else %}
									{{ _('N/D') }}
								{% endif %}
							</dd>
						</div>

					{% elif field.name == 'themes_aggregate' %}
						{% set themes = (h.load_dcatapit_subthemes(pkg_dict[field.name], lang) or []) %}

						{% if not themes %}
							<div class="rtds-grid lg:rtds-grid-cols-12">
								<dt class="rtds-col-span-3">{{ field.label }}</dt>
								<dd class="rtds-col-span-9 rtds-content-03 rtds-truncate">{{ _('N/D') }}</dd>
							</div>
						{% else %}
							{% for theme in themes %}
								<div class="rtds-grid lg:rtds-grid-cols-12">
									<dt class="rtds-col-span-3">{{ field.label }}</dt>
									<dd class="rtds-col-span-9 rtds-content-03 rtds-truncate">
										<span>{{ theme.theme }}</span>
										<br/>
										{% for subtheme in theme.subthemes %}
											<span>{{ h.get_localized_subtheme(subtheme, lang) }}</span><br/>
										{% endfor %}
									</dd>
								</div>
							{% endfor %}
						{% endif %}

					{% elif field.element == 'temporal_coverage' %}
						{% set temp_cov = (h.load_json_or_list(pkg_dict[field.name]) or []) %}

						{% if not temp_cov %}
							<div class="rtds-grid lg:rtds-grid-cols-12">
								<dt class="rtds-col-span-3">{{ field.label }}</dt>
								<dd class="rtds-col-span-9 rtds-content-03 rtds-truncate">{{ _('N/D') }}</dd>
							</div>
						{% else %}
							{% for temp in temp_cov %}
								<div class="rtds-grid lg:rtds-grid-cols-12">
									<dt class="rtds-col-span-3">{{ _(field.label) }}</dt>
									<dd class="rtds-col-span-9 rtds-content-03 rtds-truncate">
										<span>{{_('From')}}
										</span>
										<span>{{ h.format(temp.temporal_start, field.format, 'date') }}</span>
										{% if temp.temporal_end %}
											<span>
												{{_('Until')}}
											</span>
											<span>{{ h.format(temp.temporal_end, field.format, 'date') }}</span>
										{% endif %}
									</dd>
								</div>
							{% endfor %}
						{% endif %}


					{% elif field.element == 'creator' %}
						{% set creators = (h.load_json_or_list(pkg_dict[field.name]) or []) %}
						{% if not creators %}
							<div class="rtds-grid lg:rtds-grid-cols-12">
								<dt class="rtds-col-span-3">{{ field.label }}</dt>
								<dd class="rtds-col-span-9 rtds-content-03 rtds-truncate">{{ _('N/D') }}</dd>
							</div>
						{% else %}
							{% for creator in creators %}
								<div class="rtds-grid lg:rtds-grid-cols-12">
									<dt class="rtds-col-span-3">{{ _(field.label) }}</dt>
									<dd class="rtds-col-span-9 rtds-content-03 rtds-truncate">
										{% set crname = creator.creator_name[lang] or creator.creator_name%}
										{% if crname %}
											<span>{{_('Name')}}:
											</span>
											<span>{{ crname }}</span>
											<br/>
										{% endif %}
										<span>{{_('IPA/IVA')}}:
										</span>
										<span>{{ creator.creator_identifier }}</span>
									</dd>
								</div>
							{% endfor %}
						{% endif %}
					{% elif field.element == 'alternate_identifier' %}
						{% set alt_identifiers = (h.load_json_or_list(pkg_dict[field.name]) or []) %}
						{% if not alt_identifiers %}
							<div class="rtds-grid lg:rtds-grid-cols-12">
								<dt class="rtds-col-span-3">{{ field.label }}</dt>
								<dd class="rtds-col-span-9 rtds-content-03 rtds-truncate">{{ _('N/D') }}</dd>
							</div>
						{% else %}

							{% for alt_id in alt_identifiers %}
								<div class="rtds-grid lg:rtds-grid-cols-12">
									<dt class="rtds-col-span-3">{{ field.label }}</dt>
									<dd class="rtds-col-span-9 rtds-content-03 rtds-truncate">
										<span>{{ alt_id.identifier }}</span><br/>

										{% if alt_id.agent %}
											<span>{{ alt_id.agent.agent_name[lang] }}</span>
											{% if alt_id.agent.agent_identifier %}
												<br/>
												<span>{{ alt_id.agent.agent_identifier }}</span><br/>
											{% endif %}
										{% endif %}
									</dd>
								</div>
							{% endfor %}
						{% endif %}
					{% elif field.element == 'conforms_to' %}
						{% set conforms_to = h.load_json_or_list(pkg_dict[field.name]) %}

						{% if conforms_to %}
							{% for std in conforms_to %}
								<div class="rtds-grid lg:rtds-grid-cols-12">
									<dt class="rtds-col-span-3">{{ field.label }}</dt>
									<dd class="rtds-col-span-9 rtds-content-03 rtds-truncate">
										<span style="font-weight:bold">{{_('Std Identifier')}}:
										</span>
										<span>{{ std.identifier }}</span><br/>

										{% if std.get('title') and std.title[lang] %}
											<span style="font-weight:bold">{{_('Std Title')}}:
											</span>
											<span>{{ std.title[lang] }}</span><br/>
										{% endif %}
										{% if std.get('description') and std.description[lang] %}
											<span style="font-weight:bold">{{_('Std Description')}}:
											</span>
											<span>{{ std.description[lang] }}</span><br/>
										{% endif %}
										{% for ref in std['referenceDocumentation'] %}
											<span style="font-weight:bold">{{_('Std Reference documentation')}}:
											</span>
											<span>
												<a href="{{ ref }}">{{ ref }}</a>
											</span><br/>
										{% endfor %}
									</dd>
								</div>
							{% endfor %}
						{% endif %}

					{% elif field.element == 'rights_holder' %}
						{% if pkg_dict.get('holder_name') %}
							{% set couples = h.couple_to_dict(field.couples, pkg_dict)%}
							<div class="rtds-grid lg:rtds-grid-cols-12">
								<dt class="rtds-col-span-3">{{ field.label }}</dt>
								<dd class="rtds-col-span-9 rtds-content-03 rtds-truncate">
									{% if couples %}
										{% for couple in couples %}
											{% if couple %}
												<span>{{couple.label}}:
												</span>
												<span>{{couple.value}}</span><br/>
											{% else %}
												{{ _('N/D') }}
											{% endif %}
										{% endfor %}
									{% else %}
										{{ _('N/D') }}
									{% endif %}
								</dd>
							</div>

						{% else %}
							<div class="rtds-grid lg:rtds-grid-cols-12">
								<dt class="rtds-col-span-3">{{ field.label }}</dt>
								<dd class="rtds-col-span-9 rtds-content-03 rtds-truncate">{{ field.default or _('N/D') }}</dd>
							</div>
						{% endif %}
					{% else %}

						{% if pkg_dict[field.name] %}

							{% set value_field = h.get_vocabulary_items(field.vocabulary_name, pkg_dict[field.name][1:-1].split(",") if ',' in pkg_dict[field.name] else [pkg_dict[field.name]]) if field.type == 'vocabulary' else pkg_dict[field.name]%}
							{% if value_field is iterable and value_field is not string %}
								<div class="rtds-grid lg:rtds-grid-cols-12">
									<dt class="rtds-col-span-3">{{ field.label }}</dt>
									<dd class="rtds-col-span-9 rtds-content-03 rtds-truncate">{{ h.list_to_string(value_field, field.format) or field.default or _('N/D') }}</dd>
								</div>
							{% else %}
								<div class="rtds-grid lg:rtds-grid-cols-12">
									<dt class="rtds-col-span-3">{{ field.label }}</dt>
									{% if h.is_url(value_field) %}
										<dd class="rtds-col-span-9 rtds-content-03 rtds-truncate">{{ h.link_to(value_field, value_field, rel='', target='_blank') or field.default or _('N/D') }}</dd>
									{% else %}
										<dd class="rtds-col-span-9 rtds-content-03 rtds-truncate">{{ h.format(value_field, field.format, field.type) or field.default or _('N/D') }}</dd>
									{% endif %}
								</div>
							{% endif %}

						{% else %}

							<div class="rtds-grid lg:rtds-grid-cols-12">
								<dt class="rtds-col-span-3">{{ field.label }}</dt>
								<dd class="rtds-col-span-9 rtds-content-03 rtds-truncate">{{ field.default or _('N/D') }}</dd>
							</div>
						{% endif %}
					{% endif %}
				{% endif %}
			{% endfor %}
		{% endblock %}
	</dl>
</section>

{% set catalog_title = h.get_pkg_dict_extra(pkg_dict, 'source_catalog_title') %}
{% if catalog_title %}
	<section class="additional-info">
		<h3>{{ _('Source Catalog Info') }}</h3>
		<table class="table table-striped table-bordered table-condensed">
			<thead>
				<tr>
					<th scope="col">{{ _('Field') }}</th>
					<th scope="col">{{ _('Value') }}</th>
				</tr>
			</thead>
			<tbody>
				<tr>
					<th scope="row" class="dataset-label">{{ _('Name') }}</th>
					<td class="dataset-details" property="dct:title">{{ catalog_title }}</td>
				</tr>

				{% set catalog_description = h.get_pkg_dict_extra(pkg_dict, 'source_catalog_description') %}
				{% if catalog_description %}
					<tr>
						<th scope="row" class="dataset-label">{{ _('Description') }}</th>
						<td class="dataset-details" property="dct:title">{{ catalog_description }}</td>
					</tr>
				{% endif %}

				{% set catalog_homepage = h.get_pkg_dict_extra(pkg_dict, 'source_catalog_homepage') %}
				{% if catalog_homepage %}
					<tr>
						<th scope="row" class="dataset-label">{{ _('Homepage') }}</th>
						{% if h.is_url(catalog_homepage) %}
							<td class="dataset-details" property="foaf:homepage">{{ h.link_to(catalog_homepage, catalog_homepage, rel='foaf:homepage', target='_blank') }}</td>
						{% else %}
							<td class="dataset-details" property="foaf:homepage">{{ catalog_homepage }}</td>
						{% endif %}
					</tr>
				{% endif %}

				{% set catalog_modified = h.get_pkg_dict_extra(pkg_dict, 'source_catalog_modified') %}
				{% if catalog_modified %}
					<tr>
						<th scope="row" class="dataset-label">{{ _("Last Updated") }}</th>
						<td class="dataset-details">
							{% snippet 'snippets/local_friendly_datetime.html', datetime_obj=catalog_modified %}
						</td>
					</tr>
				{% endif %}
			</tbody>
		</table>
	</section>
{% endif %}
